openapi: 3.1.0
info:
  title: Full-Stack Todo - Authentication API
  description: |
    Authentication endpoints for the Full-Stack Todo application.

    ## Authentication Flow

    1. **Frontend (Better Auth)**: Handles sign-up, sign-in, OAuth flows
    2. **Backend (FastAPI)**: Verifies JWT tokens for API authorization

    ## Better Auth Endpoints (Frontend)

    These endpoints are automatically created by Better Auth at `/api/auth/*`:
    - `POST /api/auth/sign-up/email` - Register with email/password
    - `POST /api/auth/sign-in/email` - Sign in with email/password
    - `GET /api/auth/sign-in/social` - Initiate OAuth flow
    - `GET /api/auth/callback/:provider` - OAuth callback
    - `POST /api/auth/sign-out` - Sign out
    - `GET /api/auth/session` - Get current session

    ## Backend Authorization

    All backend API endpoints require Bearer JWT authentication:
    ```
    Authorization: Bearer <jwt_token>
    ```

    The JWT is obtained from Better Auth session and contains:
    - `sub`: User ID (UUID)
    - `email`: User email
    - `name`: Display name (optional)
    - `exp`: Expiration timestamp
  version: 1.0.0
  contact:
    name: Full-Stack Todo Team

servers:
  - url: http://localhost:8000/api/v1
    description: Local development server
  - url: https://api.example.com/api/v1
    description: Production server

tags:
  - name: Authentication
    description: Backend authentication verification
  - name: Users
    description: User profile operations

paths:
  /users/me:
    get:
      tags:
        - Users
      summary: Get current user profile
      description: |
        Returns the authenticated user's profile.

        If the user doesn't exist in the backend database, they are auto-created
        from JWT claims on first request.
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
              example:
                id: "550e8400-e29b-41d4-a716-446655440000"
                email: "user@example.com"
                display_name: "John Doe"
                created_at: "2025-12-27T10:00:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from Better Auth session.

        **Getting the token:**
        1. Sign in via Better Auth frontend
        2. Use `authClient.getSession()` to get session
        3. Extract JWT from session or use Better Auth's built-in API client

        **Token claims:**
        - `sub`: User UUID
        - `email`: User email address
        - `name`: Display name (optional)
        - `exp`: Expiration timestamp
        - `iat`: Issued at timestamp
        - `iss`: Issuer (Better Auth URL)

  schemas:
    UserResponse:
      type: object
      required:
        - id
        - email
        - display_name
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique user identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        email:
          type: string
          format: email
          description: User's email address
          example: "user@example.com"
        display_name:
          type: string
          maxLength: 100
          description: User's display name
          example: "John Doe"
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp
          example: "2025-12-27T10:00:00Z"

    ErrorResponse:
      type: object
      required:
        - detail
      properties:
        detail:
          type: string
          description: Human-readable error message
          example: "Authentication required"
        code:
          type: string
          description: Machine-readable error code
          example: "UNAUTHORIZED"

  responses:
    Unauthorized:
      description: Authentication required or token invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            missing_token:
              summary: No token provided
              value:
                detail: "Authentication required"
                code: "UNAUTHORIZED"
            expired_token:
              summary: Token has expired
              value:
                detail: "Token expired"
                code: "TOKEN_EXPIRED"
            invalid_token:
              summary: Token is invalid
              value:
                detail: "Invalid token"
                code: "INVALID_TOKEN"

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            detail: "Internal server error"
            code: "INTERNAL_ERROR"

security:
  - bearerAuth: []
